<!DOCTYPE html>
<html>
  <head>
    <title>GeoJSON</title>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.18.2/css/ol.css" type="text/css">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="/ol.js"></script>
    <script src="/mapbox-streets-v6-style.js"></script>
    <style>
        html {
            height: 100%;
        }
        body{
            border: 0px;
            margin: 0px;
            padding: 0px;
        }
        #map, body {
            height: 100%;
            width: 100%;
        }
    </style>
  </head>
  <body>
    <div id="map" class="map"></div>
    <script>
      var image = new ol.style.Circle({
        radius: 5,
        fill: null,
        stroke: new ol.style.Stroke({color: 'red', width: 1})
      });

      var styles = {
        'Point': new ol.style.Style({
          image: image
        }),
        'LineString': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'green',
            width: 1
          })
        }),
        'MultiLineString': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'green',
            width: 1
          })
        }),
        'MultiPoint': new ol.style.Style({
          image: image
        }),
        'MultiPolygon': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'yellow',
            width: 1
          }),
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 0, 0.1)'
          })
        }),
        'Polygon': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'blue',
            lineDash: [4],
            width: 3
          }),
          fill: new ol.style.Fill({
            color: 'rgba(0, 0, 255, 0.1)'
          })
        }),
        'GeometryCollection': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'magenta',
            width: 2
          }),
          fill: new ol.style.Fill({
            color: 'magenta'
          }),
          image: new ol.style.Circle({
            radius: 10,
            fill: null,
            stroke: new ol.style.Stroke({
              color: 'magenta'
            })
          })
        }),
        'Circle': new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'red',
            width: 2
          }),
          fill: new ol.style.Fill({
            color: 'rgba(255,0,0,0.2)'
          })
        })
    };

    function styleFunction(feature) {
        return styles[feature.getGeometry().getType()];
    };

    var map;

    $(function() {
        map = new ol.Map({
            layers: [
            new ol.layer.VectorTile({
                source: new ol.source.VectorTile({
                  attributions: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> ' +
                    '© <a href="http://www.openstreetmap.org/copyright">' +
                    'OpenStreetMap contributors</a>',
                  format: new ol.format.MVT(),
                  tileGrid: ol.tilegrid.createXYZ({maxZoom: 22}),
                  tilePixelRatio: 16,
                  url: 'https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/' +
                      '{z}/{x}/{y}.vector.pbf?access_token=pk.eyJ1IjoicnVzc3NzIiwiYSI6ImNpdGVzaXphejAwNjAzbnRvYW8zc3AxMWsifQ.E2uDeHpaPq5cySXU_I3cYQ'
                }),
                style: createMapboxStreetsV6Style()
          })
        ],
        target: 'map',
        controls: ol.control.defaults({
          attributionOptions: ({
            collapsible: false
          })
        }),
        view: new ol.View({
            center: (new ol.geom.Point([-0.60727, 51.21265])).transform('EPSG:4326', 'EPSG:3857').getCoordinates(),
          zoom: 17
        })
        });
        $.getJSON('/vector_layers.json', addVectorLayers);
        });

    function addVectorLayers(layer_data) {
        $.each(layer_data, function(index, layer) {
            var vectorSource = new ol.source.Vector({
                url: layer.source,
                format: new ol.format.GeoJSON()
            });

            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: styleFunction,
                updateWhileAnimating: true,
                updateWhileInteracting: true
                });
            map.addLayer(vectorLayer);
        });
    }
    </script>
  </body>
</html>
